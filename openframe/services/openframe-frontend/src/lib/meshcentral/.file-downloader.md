<!-- source-hash: a8ee1d602a2157d62d0f4b8386865898 -->
A TypeScript class that manages file downloads from MeshCentral servers, handling the WebSocket protocol for binary file transfers with progress tracking and chunked data reception.

## Key Components

- **`DownloadTask`** - Interface defining download task state including chunks, progress, and status
- **`FileDownloader`** - Main class managing download lifecycle and MeshCentral protocol communication
- **`downloadFile()`** - Initiates a new file download request
- **`handleBinaryChunk()`** - Processes incoming binary data chunks with MeshCentral protocol parsing
- **`handleControlMessage()`** - Handles server control messages (start, cancel, error)
- **`saveFile()`** - Triggers browser download of completed file
- **`getFileBlob()`** - Converts received chunks into a downloadable Blob

## Usage Example

```typescript
import { FileDownloader } from './file-downloader'

// Initialize downloader with WebSocket message sender and progress callback
const downloader = new FileDownloader(
  (data) => websocket.send(data), // Message sender function
  (progress) => {
    console.log(`${progress.file}: ${progress.progress}% complete`)
  },
  (fileName, reason) => {
    console.log(`Download cancelled: ${fileName} - ${reason}`)
  }
)

// Start downloading a file
const downloadId = downloader.downloadFile('/remote/path/document.pdf', 'document.pdf')

// Handle incoming binary chunks
websocket.onmessage = (event) => {
  if (event.data instanceof ArrayBuffer) {
    downloader.handleBinaryChunk(new Uint8Array(event.data), false)
  } else {
    const message = JSON.parse(event.data)
    if (message.action === 'download') {
      downloader.handleControlMessage(message)
    }
  }
}

// Cancel if needed
downloader.cancelDownload(downloadId)
```

The class implements the MeshCentral binary protocol where each chunk includes a 4-byte big-endian header with flags indicating the final chunk, and automatically saves completed downloads to the user's device.