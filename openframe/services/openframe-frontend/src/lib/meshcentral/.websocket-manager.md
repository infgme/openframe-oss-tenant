<!-- source-hash: 33f03d28b99ebbb9896a925915e69f57 -->
A robust WebSocket connection manager for Flamingo's real-time communication features with automatic reconnection, message queuing, and authentication token refresh capabilities.

## Key Components

**WebSocketManager Class**
- `connect()` - Establishes WebSocket connection with configurable URL and protocols
- `send()` - Sends messages with automatic queuing when disconnected
- `reconnect()` - Manually triggers reconnection with backoff reset
- `disconnect()` - Cleanly closes connection and stops reconnection attempts
- `dispose()` - Full cleanup including message queue clearing

**State Management**
- `WebSocketState` - Connection state type: 'disconnected' | 'connecting' | 'connected' | 'reconnecting' | 'failed'
- `getState()` / `isConnected()` - Current connection status accessors
- `onStateChange` callback for real-time state monitoring

**Resilience Features**
- Exponential backoff reconnection with configurable attempts and delays
- Authentication token refresh before reconnect attempts
- Message queuing during disconnection periods
- Smart reconnection logic based on close codes (auth failures vs network issues)

## Usage Example

```typescript
import { WebSocketManager } from './websocket-manager'

const wsManager = new WebSocketManager({
  url: () => `wss://api.flamingo.com/ws?token=${getAuthToken()}`,
  maxReconnectAttempts: 10,
  reconnectBackoff: [1000, 2000, 5000, 10000],
  onStateChange: (state) => console.log('WebSocket state:', state),
  onMessage: (event) => handleIncomingMessage(JSON.parse(event.data)),
  onError: (error) => console.error('WebSocket error:', error),
  shouldReconnect: (closeEvent) => closeEvent.code !== 1000,
  refreshTokenBeforeReconnect: true,
  enableMessageQueue: true
})

// Connect and send messages
await wsManager.connect()
wsManager.send(JSON.stringify({ type: 'ping', timestamp: Date.now() }))

// Clean shutdown
wsManager.dispose()
```