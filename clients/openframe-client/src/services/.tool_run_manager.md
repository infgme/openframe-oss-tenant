<!-- source-hash: e53419b8c6ee26438c9e6c2bd33df2e6 -->
Manages the execution and lifecycle of tools within user sessions on Windows systems. Handles launching processes in the appropriate user context, monitoring their execution, and managing retries for failed tool runs.

## Key Components

### Core Functions
- **`run_tool_with_retry`** - Main entry point for tool execution with automatic retry logic
- **`run_tool_once`** - Single tool execution attempt with proper process management
- **`get_active_user_session`** (Windows) - Detects and selects the best active user session
- **`launch_process_in_user_session`** (Windows) - Launches processes in user context with proper token handling

### Windows Session Management
- **`to_wide`** - Converts strings to UTF-16 for Windows API calls
- **`launch_process_in_console_session`** - Alternative launcher for console-based execution
- **`wcslen`** - Calculates wide string length for Windows API compatibility

### Supporting Services
- **`InstalledToolsService`** - Tool metadata and configuration management
- **`ToolCommandParamsResolver`** - Command parameter resolution and substitution
- **`ToolKillService`** - Process termination and cleanup

## Usage Example

```rust
use crate::tool_run_manager::ToolRunManager;
use crate::models::installed_tool::InstalledTool;

// Create tool run manager with shared services
let tool_run_manager = ToolRunManager::new(
    installed_tools_service,
    tool_command_params_resolver,
    tool_kill_service,
);

// Execute a tool with automatic retry on failure
let tool = InstalledTool {
    name: "network_scanner".to_string(),
    command: "nmap".to_string(),
    // ... other tool configuration
};

match tool_run_manager.run_tool_with_retry(&tool, &params).await {
    Ok(exit_code) => println!("Tool completed with exit code: {}", exit_code),
    Err(e) => eprintln!("Tool execution failed: {}", e),
}
```

The manager automatically handles Windows session detection, user token management, process isolation, and retry logic with configurable delays. It includes comprehensive logging for debugging session selection and process launch issues.