<!-- source-hash: 2e416c2976c896c4c12c9475a0551245 -->
A service for managing persistent update state during application updates, tracking update progress and enabling recovery from interrupted updates.

## Key Components

- **`UpdateStateService`** - Main service struct that manages update state persistence
- **`new()`** - Constructor that initializes the service with a secured directory path
- **`load()`** - Asynchronously loads existing update state from JSON file
- **`save()`** - Persists current update state to JSON file with pretty formatting
- **`clear()`** - Removes the state file to indicate update completion
- **`has_incomplete_update()`** - Checks if there's an ongoing update that needs recovery
- **`get_state_file_path()`** - Returns the file path as a string for debugging

## Usage Example

```rust
use crate::services::update_state_service::UpdateStateService;
use crate::models::update_state::{UpdateState, UpdatePhase};
use crate::platform::directories::DirectoryManager;

// Initialize the service
let directory_manager = DirectoryManager::new()?;
let update_service = UpdateStateService::new(directory_manager)?;

// Check for incomplete updates on startup
if update_service.has_incomplete_update().await? {
    println!("Found incomplete update, initiating recovery...");
    if let Some(state) = update_service.load().await? {
        println!("Resuming update for version: {}", state.target_version);
    }
}

// Save update progress
let state = UpdateState {
    target_version: "1.2.0".to_string(),
    phase: UpdatePhase::Downloading,
};
update_service.save(&state).await?;

// Clear state when update completes
update_service.clear().await?;
```

The service uses JSON serialization for human-readable state files and includes comprehensive error handling with context for debugging failed operations.