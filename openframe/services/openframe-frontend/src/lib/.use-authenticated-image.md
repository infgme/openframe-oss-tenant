<!-- source-hash: ae09fd61dbb393ace5b6270cf3874b7e -->
A React hook that fetches images requiring authentication by using credentials and auth headers, returning a blob URL safe for use in img tags.

## Key Components

- **useAuthenticatedImage** - Main hook that accepts an image URL and optional refresh key
- **State Management** - Tracks fetched image URL, loading state, and error conditions
- **URL Processing** - Handles relative/absolute URLs and constructs proper tenant-based endpoints
- **Authentication** - Includes cookies via `credentials: 'include'` and Bearer tokens when available
- **Memory Management** - Automatically cleans up blob URLs to prevent memory leaks

## Usage Example

```typescript
import { useAuthenticatedImage } from './use-authenticated-image'

function ProfileImage({ userId }: { userId: string }) {
  const { imageUrl, isLoading, error } = useAuthenticatedImage(
    `/users/${userId}/avatar`,
    Date.now() // Force refresh on component mount
  )

  if (isLoading) return <div>Loading image...</div>
  if (error) return <div>Error: {error}</div>
  if (!imageUrl) return <div>No image available</div>

  return <img src={imageUrl} alt="Profile" />
}

// Force refresh after upload
function ImageUploader() {
  const [refreshKey, setRefreshKey] = useState(Date.now())
  const { imageUrl, isLoading } = useAuthenticatedImage(
    '/api/uploaded-image.jpg',
    refreshKey
  )

  const handleUpload = () => {
    // Upload logic...
    setRefreshKey(Date.now()) // Trigger re-fetch
  }

  return (
    <div>
      <button onClick={handleUpload}>Upload</button>
      {imageUrl && <img src={imageUrl} alt="Uploaded" />}
    </div>
  )
}
```